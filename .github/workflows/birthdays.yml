- name: Run birthday script
  env:
    GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
    TOKEN_JSON: ${{ secrets.TOKEN_JSON }}
    EMAIL_USER: ${{ secrets.EMAIL_USER }}
    EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
    GMAIL_GROUP_ID: ${{ secrets.GMAIL_GROUP_ID }}
    GMAIL_FALLBACK_ID: ${{ secrets.GMAIL_FALLBACK_ID }}
    SHEET_ID: ${{ secrets.SHEET_ID }}
    SHEET_TAB: Log

    # Tell script where to read/write
    CREDENTIALS_PATH: credentials.json
    TOKEN_PATH: token.json
  run: |
    # credentials.json
    echo "$GOOGLE_CREDENTIALS_JSON" > credentials.json

    # token.json (detect base64 vs raw)
    if echo "$TOKEN_JSON" | grep -q '^{'; then
      echo "$TOKEN_JSON" > token.json
    else
      echo "$TOKEN_JSON" | base64 --decode > token.json || echo "$TOKEN_JSON" > token.json
    fi

    python birthdays_google.py
